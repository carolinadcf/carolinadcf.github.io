<html>

<head>
    <title>Carol's Portfolio</title>
    <link rel="icon" type="image/x-icon" href="./data/carol.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="./style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.skypack.dev/three@0.136/",
                "three/addons/": "https://cdn.skypack.dev/three@0.136/examples/jsm/"
            }
        }
    </script>

</head>

<body>
    <div id="preloader" class="preloader">
        <div class="ticket">
            <div class="check">

                <div class="title">
                    <h1>CAROL'S MUSEUM</h1>
                </div>

                <hr class="separator">

                <div class="subtitle">
                    <h3>Welcome to my portfolio.</h3>
                    <h3>Work in progress. Be patient :)</h3>
                </div>

                <div class="info">
                    <p id="update"></p>
                    <p>Barcelona</p>
                </div>

                <div class="extra-info">
                    <p>@carolina.dcf</p>
                </div>
            </div>

            <div class="stub" id="preloader-stub">
                <div class="stub-text">
                    <h1>Loading...</h1>
                </div>

                <div class="barcode"></div>
                <div class="stub-number">
                    <p>Ticket No: 12343315</p>
                </div>
            </div>
        </div>
    </div>

    <div class="main-ui">
        <!-- about me -->
        <h2 id="about-me-button" class="about-me-button">About Me</h2>
    </div>
    <h2 id="close-button" class="close-button">Close</h2>
    <div class="scene-ui">
        <!-- visit link button -->
        <a id="visit-link-button" class="visit-link-button">Visit â†’</a>
    </div>

    <script type="module">
        // get the last commit date
        async function getLastCommitDate(owner, repo, branch) {
            const url = `https://api.github.com/repos/${owner}/${repo}/commits/${branch}`;

            const response = await fetch(url, {
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status}`);
            }

            const data = await response.json();
            const commitDate = data.commit.committer.date;

            return commitDate;
        }

        // Format the date to DD/MM/YYYY
        function formatDate(isoDateStr) {
            const date = new Date(isoDateStr);
            const day = String(date.getUTCDate()).padStart(2, '0');
            const month = String(date.getUTCMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const year = date.getUTCFullYear();
            return `${day}/${month}/${year}`;
        }

        await getLastCommitDate('carolinadcf', 'carolinadcf.github.io', 'main')
            .then(date => {
                const formattedDate = formatDate(date);
                document.getElementById('update').innerText = `Last update: ${formattedDate}`;
            })
            .catch(err => {
                console.error(err);
                '';
            });
    </script>

    <!-- detect if on mobile via feature detection -->
    <!-- https://medium.com/geekculture/detecting-mobile-vs-desktop-browsers-in-javascript-ad46e8d23ce5 -->
    <script>
        function hasTouchSupport() {
            return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        }

        if (hasTouchSupport()) {
            console.log("Mobile device detected");
            // redirec to mobile version
            window.location.href = "web.html";
        } else {
            console.log("Desktop device detected");
        }
    </script>

    <!-- about me button -->
    <script>
        // show ticket preloader with about me info
        document.getElementById('about-me-button').addEventListener('click', function () {
            console.log('About me button clicked');
            const preloader = document.getElementById('preloader');
            preloader.classList.remove('preloader-animated');
            const preloaderStub = document.getElementById('preloader-stub');
            preloaderStub.classList.remove('stub-animated');

            // show close button
            const closeButton = document.getElementById('close-button');
            closeButton.style.display = 'block';

            // freeze 3D scene interaction when about me is open
            const canvas = document.querySelector('canvas');
            if (canvas) {
                canvas.style.pointerEvents = 'none';
            }
        });

        // close button
        document.getElementById('close-button').addEventListener('click', function () {
            console.log('Close button clicked');
            // hide ticket preloader with about me info
            const preloader = document.getElementById('preloader');
            preloader.classList.add('preloader-animated');
            const preloaderStub = document.getElementById('preloader-stub');
            preloaderStub.classList.add('stub-animated');

            // hide close button
            const closeButton = document.getElementById('close-button');
            closeButton.style.display = 'none';

            // enable 3D scene interaction when about me is closed
            const canvas = document.querySelector('canvas');
            if (canvas) {
                canvas.style.pointerEvents = 'auto';
            }
        });

    </script>

    <script src="./index.js" type="module"></script>

</body>

</html>